<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Выбор ячейки</title>
    <style>
        /* Стили для ячеек */
        .cell-container {
            text-align: center;
        }

        .cell {
            position: relative;
            display: inline-block;
            padding: 20px;
            margin: 10px;
            border: 1px solid #ccc;
            cursor: pointer;
            background-color: #B9F6CA; /* Изначально свободные ячейки зеленого цвета */
        }

        .cell.booked .status {
            background-color: #FFBABA; /* Квадрат за QR-кодом, когда ячейка занята */
        }

        .cell.reserved .status {
            background-color: #FFCC80; /* Квадрат за QR-кодом, когда ячейка забронирована */
        }

        .status {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: background-color 0.3s ease;
            pointer-events: none; /* Чтобы события мыши не передавались этому элементу */
        }

        .qr-container {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>Выберите ячейку</h1>

    <div class="cell-container" id="cellContainer">
        <!-- Здесь будут QR-коды -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cellContainer = document.getElementById('cellContainer');

            const selectedCells = JSON.parse(localStorage.getItem('selectedCells')) || {};

            for (let i = 1; i <= 5; i++) {
                const cellWrapper = document.createElement('div');
                cellWrapper.classList.add('cell');

                const cellNumber = document.createElement('p');
                cellNumber.textContent = `Ячейка №${i}`;
                cellNumber.style.marginBottom = '5px';

                const qrContainer = document.createElement('div');
                qrContainer.classList.add('qr-container');

                const qr = new QRious({
                    value: `https://vladlenn13.github.io/Web/order/${i}`,
                    size: 100
                });

                const qrImage = document.createElement('img');
                qrImage.src = qr.toDataURL();
                qrImage.alt = `QR-код для ячейки ${i}`;

                const status = document.createElement('div');
                status.classList.add('status');

                qrContainer.appendChild(qrImage);
                qrContainer.appendChild(status);
                cellWrapper.appendChild(cellNumber);
                cellWrapper.appendChild(qrContainer);
                cellContainer.appendChild(cellWrapper);

                if (selectedCells[i]) {
                    cellWrapper.classList.add('booked');
                }

                cellWrapper.addEventListener('click', () => {
                    const isBooked = cellWrapper.classList.contains('booked');
                    const isReserved = cellWrapper.classList.contains('reserved');

                    if (isBooked) {
                        alert('Ячейка занята, выберете другую!');
                    } else if (isReserved) {
                        const confirmCancel = confirm('Вы хотите отменить бронь на эту ячейку?');
                        if (confirmCancel) {
                            cellWrapper.classList.remove('reserved');
                            localStorage.setItem('selectedCells', JSON.stringify(selectedCells));
                            alert('Вы успешно отменили бронь на ячейке');
                        }
                    } else {
                        const confirmBooking = confirm(`Вы хотите забронировать ячейку ${i}?`);
                        if (confirmBooking) {
                            cellWrapper.classList.remove('cell');
                            cellWrapper.classList.add('reserved');
                            selectedCells[i] = true;
                            localStorage.setItem('selectedCells', JSON.stringify(selectedCells));
                            alert(`Вы успешно забронировали ячейку ${i}`);
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>
